<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
	<link rel="shortcut icon" href="image/gift.ico">
	<link rel="stylesheet" type="text/css" href="CSS/balloon.css">
	<head>
		<meta charset="utf-8">
	</head>
</html>
<title>Secret</title>

<style type="text/css">
@font-face {
	font-family: 'Sketch';
	src: url('font/BuxtonSketch.ttf');
}

@font-face {
	font-family: 'Chinese';
	src: url('font/ChineseSketch.ttf');
}

html, body {
	width: 100dvw;
	height: 100dvh;
}

body {
	margin: 0;
	/* overflow: hidden; */
	background: url('image/sky.jpg');
}

#start {
	width: 100dvw;
	height: 100dvh;
	background: #f6d18e;
	position: absolute;
	z-index: 8;
	font-family: 'Chinese';
	font-size: 150px;
	color: #fff;
	text-align: center;
	cursor: pointer;
	display: flex;
	align-items: center;
	justify-content: center;
}

.start-btn {
	position: relative;
	font-size: 2rem;
	font-family: 'Chinese';
	font-size: 4rem;
	color: #5e3c1a;
	background: #ffe7ad;
	border: 3px solid #65cfcf;
	border-radius: 22px;
	box-shadow: 0 8px 24px 0 rgba(120, 180, 255, 0.15), 0 2px 8px #fff;
	cursor: pointer;
	transition: transform 0.18s, box-shadow 0.18s;
	letter-spacing: 2px;
	text-shadow: 1px 2px 0 #fff9e0, 0 2px 6px #b9d0f6;
}

.start-btn-padding {
	padding: 18px 74px;
}

.start-btn::before {
	content: '';
	position: absolute;
	left: 12px; 
	top: 10px;
	width: 22px;
	height: 22px;
	background: radial-gradient(circle, #65cfcf 70%, #fff7b8 100%);
	border-radius: 50%;
	opacity: 0.7;
	box-shadow: 0 0 12px #65cfcf55;
}

.start-btn::after {
	content: '';
	position: absolute;
	right: 18px;
	bottom: 10px;
	width: 16px;
	height: 16px;
	background: radial-gradient(circle, #ffbcbc 70%, #fff6d6 100%);
	border-radius: 50%;
	opacity: 0.7;
	box-shadow: 0 0 8px #ffbcbc55;
}

.banner-flags {
	position: absolute;
	top: -90px;
	left: 50%;
	transform: translateX(-50%);
	display: flex;
	gap: 3px;
	z-index: 1;
}

.flag {
	width: 22px;
	height: 20px;
	border-radius: 3px;
	display: inline-block;
	font-size: 1rem;
	font-family: inherit;
	font-size: 3rem;
	text-align: center;
	line-height: 21px;
	color: #fff;
	font-weight: bold;
	box-shadow: 0 1px 2px #aaa;
	padding: 20px;
}

.flag.flag-yellow { background: #ffe75c; color: #5e3c1a; }

.flag.flag-blue { background: #65cfcf; color: #fff; }

.flag.flag-red { background: #ffbcbc; color: #fff; }

.flag.flag-green { background: #63d798; color: #fff; }

.flag.flag-orange { background: #ffb96c; color: #fff; }

.boxlight {
	width: 100dvw;
	height: 100dvh;
	position: fixed;
	z-index: 3;
	background: #525181dd;
	color: #fff;
	font-size: 140px;
	font-family: 'Sketch';
	text-align: center;
	display: none;
	align-items: center;
	justify-content: center;
	flex-direction: column;
}

.GoButton {
	width: 240px;
	height: 120px;
	font-size: 100px;
	line-height: 120px;
	margin-left: auto;
	margin-right: auto;
	cursor: pointer;
	border-radius: 120px;
	background: rgb(0,170,220);
	transition-duration: 500ms;
	-o-transition-duration: 500ms;
	-ms-transition-duration: 500ms;
	-moz-transition-duration: 500ms;
	-webkit-transition-duration: 500ms;
}

.GoButton:hover {
	color: rgb(0,170,220);
	background: #000;
}

.view {
	width: 100dvw;
	height: 100dvh;
	display: flex;
	align-items: center;
	justify-content: center;
}

.init-container {
	width: 100dvw;
	height: 100dvh;
	position: relative;
	z-index: 2;
	overflow: hidden;
}

.room {
	width: 100dvw;
	height: 100dvh;
	position: absolute;
	z-index: 1;
	background: url('image/room_wall.jpg');
}

.room div {
	position: absolute;
	z-index: 1;
}

.room img {
	position: absolute;
	z-index: 1;
}

.light {
	opacity: 0;
}

.light_switch {
	top: 0;
}

.light_render {
	opacity: 0;
}

.girl {
	position: fixed;
}

.girl-img {
	position: relative;
}

.floor {
	position: fixed;
	width: 100%;
}

.floorMove {
	bottom: 0px;
	animation: floorUp 1s ease-in;
	-webkit-animation: floorUp 1s ease-in;
}

@keyframes floorUp {
	0% {bottom: -302px;}
	100% {bottom: 0px;}
}

@-webkit-keyframes floorUp {
	0% {bottom: -302px;}
	100% {bottom: 0px;}
}

.wall_paint {
	width: 100%;
	height: 100%;
	/* background-image: url(image/wall_paint_repeat.png);
	background-repeat: repeat; */
}

.wall_paintMove {
	opacity: 1;
	animation: wallPaintFadeIn 1.8s ease-in;
	-webkit-animation: wallPaintFadeIn 1.8s ease-in;
}

@keyframes wallPaintFadeIn {
	0% {opacity: 0;}
	100% {opacity: 1;}
}

@-webkit-keyframes wallPaintFadeIn {
	0% {opacity: 0;}
	30% {opacity: 0;}
	100% {opacity: 1;}
}

.birthday {
	position: fixed;
	width: 100%;
	height: 250px;
	display: flex;
	align-items: center;
	justify-content: center;
}

.birthday img {
	width: 100%;
}

.birthdayMove {
	top: 30%;
	animation: birthdayDown 1.5s ease-in;
	-webkit-animation: birthdayDown 1.5s ease-in;
}

@keyframes birthdayDown {
	0% {top: -50%;}
	100% {top: 30%;}
}

@-webkit-keyframes birthdayDown {
	0% {top: -50%;}
	100% {top: 30%;}
}

.window {
	position: fixed;
	opacity: 0;
}

.TV {
	position: fixed;
	cursor: pointer;
	opacity: 0;
}

.desk {
	position: fixed;
	opacity: 0;
}

.picture {
	position: fixed;
	opacity: 0;
	cursor: pointer;
}

.balloon {
	position: fixed;
	opacity: 0;
}

.calender {
	position: fixed;
	opacity: 0;
	cursor: pointer;
}

.sofa {
	position: fixed;
	opacity: 0;
	cursor: pointer;
}

.talk_prompt {
	opacity: 0;
	position: fixed;
}

.talk_prompt > .next_step {
	cursor: pointer;
}

.talk_prompt > .next_step:hover {
	transform: rotateZ(-16deg);
	-o-transform: rotateZ(-16deg);
	-ms-transform: rotateZ(-16deg);
	-moz-transform: rotateZ(-16deg);
	-webkit-transform: rotateZ(-16deg);
}

.mail {
	opacity: 0;
	position: fixed;
}

.mail > .mail-content {
	padding: 40px;
	top: 0;
	left: 0;
	width: 108px;
	height: 74px;
	background-color: white;
	position: absolute;
	opacity: 0;
	box-sizing: border-box;
}

.mail p {
	display: none;
	font-family: 'Chinese';
	font-size: 3rem;
	color: #000;
	z-index: 5;
}

.mailFly {
	transform: rotate(0deg);
	-webkit-transform: rotate(0deg);
}

.mailOpen {
	animation: mailOpen 2s ease;
	-webkit-animation: mailOpen 2s ease;
	transform-origin: 0% 2px;
	-webkit-transform-origin: 0% 2px;
	transform: rotateX(180deg);
	-webkit-transform: rotateX(180deg);
}

@keyframes mailOpen {
	0% {transform: rotateX(0deg);}
	100% {transform: rotateX(180deg);}
}

@-webkit-keyframes mailOpen {
	0% {-webkit-transform: rotateX(0deg);}
	100% {-webkit-transform: rotateX(180deg);}
}

.gift {
	position: fixed;
	opacity: 0;
}

.giftOpen {
	transform-origin: 0% 60px;
	-webkit-transform-origin: 0% 60px;
	animation: giftOpening 2s ease;
	-webkit-animation: giftOpening 2s ease;
	transform: rotateZ(-120deg);
	-webkit-transform: rotateZ(-120deg);
}

@keyframes giftOpening {
	0% {transform: rotateZ(0deg);}
	100% {transform: rotateZ(-120deg);}
}

@-webkit-keyframes giftOpening {
	0% {-webkit-transform: rotateZ(0deg);}
	100% {-webkit-transform: rotateZ(-120deg);}
}

.sky {
	width: 100%;
	height: 100%;
	position: absolute;
	z-index: 0;
	background: url('image/sky.jpg');
}

.hot_balloon {
	position: fixed;
	z-index: 1;
}

.hot_balloon img {
	position: absolute;
	z-index: 2;
}

.cloud {
	position: fixed;
	display: none;
}

.cloudDown1 {
	animation: cloudFly1 12s infinite linear;
	-webkit-animation: cloudFly1 12s infinite linear;
}

@keyframes cloudFly1 {
	0% {top: -100%;}
	100% {top: 100%;}
}

@-webkit-keyframes cloudFly1 {
	0% {top: -100%;}
	100% {top: 100%;}
}

.cloudDown2 {
	animation: cloudFly2 12s infinite linear;
	-webkit-animation: cloudFly2 12s infinite linear;
}

@keyframes cloudFly2 {
	0% {top: -150%;}
	30% {top: -150%;}
	100% {top: 100%;}
}

@-webkit-keyframes cloudFly2 {
	0% {top: -150%;}
	30% {top: -150%;}
	100% {top: 100%;}
}

.bird {
	position: absolute;
	z-index: 1;
}

.birdFly {
	animation: birdFlying 5s linear;
	-webkit-animation: birdFlying 5s linear;
}

@keyframes birdFlying {
	0% {top: 60%; left: -50%}
	100% {top: -10%; left: 120%;}
}

@-webkit-keyframes birdFlying {
	0% {top: 60%; left: -50%}
	100% {top: -10%; left: 120%;}
}

.parachuteBear {
	position: absolute;
	z-index: 1;
	left: 50%;
	top: -40%;
	transform: translateX(-50%);
	-webkit-transform: translateX(-50%);
	animation: bearFly 5s infinite ease;
	-webkit-animation: bearFly 5s infinite ease;
}

@keyframes bearFly {
	0% {left: 60%; transform: rotate(15deg) translateX(-50%);}
	25% {left: 40%; transform: rotate(-10deg) translateX(-50%);}
	50% {left: 60%; transform: rotate(15deg) translateX(-50%);}
	75% {left: 40%; transform: rotate(-10deg) translateX(-50%);}
	100% {left: 60%; transform: rotate(15deg) translateX(-50%);}
}

@-webkit-keyframes bearFly {
	0% {left: 60%; -webkit-transform: rotate(15deg) translateX(-50%);}
	25% {left: 40%; -webkit-transform: rotate(-10deg) translateX(-50%);}
	50% {left: 60%; -webkit-transform: rotate(15deg) translateX(-50%);}
	75% {left: 40%; -webkit-transform: rotate(-10deg) translateX(-50%);}
	100% {left: 60%; -webkit-transform: rotate(15deg) translateX(-50%);}
}

.UFO {
	position: absolute;
	z-index: 5;
	top: -40%;
}

.UFOFLY {
	top: 40%;
	left: 25%;
	transform: translateX(-50%);
	-webkit-transform: translateX(-50%);
	animation: UFOFly 5s ease;
	-webkit-animation: UFOFly 5s ease;
}

@keyframes UFOFly {
	0% {top: -40%; transform: rotate(15deg) translateX(-50%);}
	20% {top: 10%; left: 55%; transform: rotate(15deg) translateX(-50%);}
	30% {top: 10%; left: 55%; transform: rotate(0deg) translateX(-50%);}
	40% {top: 40%; left: 25%; transform: rotate(0deg) translateX(-50%);}
	100% {top: 40%; left: 25%; transform: rotate(0deg) translateX(-50%);}
}

@-webkit-keyframes UFOFly {
	0% {top: -40%; -webkit-transform: rotate(15deg) translateX(-50%);}
	20% {top: 10%; left: 55%; -webkit-transform: rotate(15deg) translateX(-50%);}
	30% {top: 10%; left: 55%; -webkit-transform: rotate(0deg) translateX(-50%);}
	40% {top: 40%; left: 25%; -webkit-transform: rotate(0deg) translateX(-50%);}
	100% {top: 40%; left: 25%; -webkit-transform: rotate(0deg) translateX(-50%);}
}

.end {
	top: 0;
	left: 0;
	opacity: 0;
	width: 100%;
	height: 100%;
	display: none;
	align-items: center;
	justify-content: center;	
	position: absolute;
	z-index: 8;
	font-family: 'Chinese';
	color: #fff;
	text-align: center;
	flex-direction: column;
}

.end .end-title {
	margin-top: 100%;
	font-size: 10rem;
	transform: translateY(-50%);
	-webkit-transform: translateY(-50%);
}

.end .end-whisper {
	opacity: 0;
	margin-top: 20px;
}

.whisper-btn {
	font-size: 4rem;
	line-height: 6rem;
	padding: 18px 20px;
}

.confetti-container {
	position: fixed;
}

.confetti {
	position: absolute;
	width: 10px;
	height: 10px;
	border-radius: 2px;
	opacity: 0;
	animation: shoot 1s ease-out forwards;
}

@keyframes shoot {
	0% { transform: translate(0, 0) scale(1); opacity: 1; }
	100% { transform: translate(var(--x), var(--y)) scale(0.8); opacity: 0; }
}

.whisper-content {
	top: 0;
	left: 0;
	opacity: 0;
	width: 100dvw;
	height: 100dvh;
	box-sizing: border-box;
	display: none;
	padding: 0 20px;
	align-items: center;
	justify-content: center;	
	position: absolute;
	z-index: 10;
	font-family: 'Chinese';
	color: #fff;
	text-align: center;
	flex-direction: column;
	background-image: url('./image/sky_night.jpg');
}

.whisper-text {
	font-size: 4rem;
	line-height: 4rem;
	opacity: 0;
}

.whisper-lg-text {
	top: 30px;
	font-size: 6rem;
	opacity: 0;
	position: relative;
}
</style>

<body>
	<!-- 載入畫面 -->
	<div id="loading-screen" style="
		position: fixed;
		top: 0;
		left: 0;
		width: 100dvw;
		height: 100dvh;
		background: linear-gradient(45deg, #f6d18e, #ffb74d);
		display: flex;
		flex-direction: column;
		justify-content: center;
		align-items: center;
		z-index: 10;
		font-family: 'Sketch', Arial, sans-serif;
		color: #fff;
		font-size: 36px;
	">
		<div style="margin-bottom: 30px;">請稍後...</div>
		<div id="loading-progress" style="
			width: 300px;
			height: 6px;
			background: rgba(255,255,255,0.3);
			border-radius: 3px;
			overflow: hidden;
		">
			<div id="progress-bar" style="
				width: 0%;
				height: 100%;
				background: #fff;
				border-radius: 3px;
				transition: width 0.3s ease;
			"></div>
		</div>
		<div id="loading-text" style="margin-top: 20px; font-size: 18px;">正在載入...</div>
	</div>

	<div class="start" id="start">
		<!-- 按一下開始 -->
		<button class="start-btn start-btn-padding">
			<span class="banner-flags">
				<span class="flag flag-yellow">S</span>
				<span class="flag flag-blue">T</span>
				<span class="flag flag-red">A</span>
				<span class="flag flag-green">R</span>
				<span class="flag flag-orange">T</span>
			</span>
			開始
		</button>
	</div>
	
	<div class="boxlight">
		<p></p>
		<div class="GoButton">GO</div>
	</div>

	<div class="view">
		<div class="init-container">
			<div class="room">
				<div class="window">
					<img src="image/window.png" class="window-img" />
				</div>
				
				<div class="birthday">
					<img src="image/birthday2.png" class="birthday-img" />
				</div>
				
				<div class="TV">
					<img src="image/TV2_On.png" />
					<img src="image/TV2_On_wheel_water.png" class="TV_wheel_water" style="display: none;" />
					<img src="image/TV2_On_wheel.png" class="TV_wheel" style="display: none;" />
					<img src="image/TV2.png" class="object tv-img" />
				</div>
				
				<div class="desk">
					<img src="image/desk2.png" class="desk-img" />
				</div>
				
				<div class="calender">
					<img src="image/calender2.png" class="object calender-img" />
				</div>
				
				<div class="picture">
					<img src="image/picture2.png" class="picture-img" />
				</div>
				
				<!-- <div class="light">
					<img src="image/light_switch.png" class="light_switch" />
					<img src="image/light.png" class="light-img" />
				</div> -->
				
				<div class="sofa">
					<img src="image/sofa.png" class="sofa-img" />
					<img src="image/sofa_pillow.png" />
					<img src="image/bear.png" class="bear" />
					<img src="image/sofa_cushion.png" />
				</div>
				
				<img src="image/balloon_3.png" name="flying" id="balloon3" class="balloon balloon3" />
		
				<div class="gift">
					<img src="image/cake.png" class="cake" style="cursor:pointer;" />
					<img src="image/gift.png" id="gift" class="gift-img" />
					<img src="image/gift_top.png" class="giftTop" />
				</div>
		
				<div class="mail">
					<img src="image/mail_back.png" id="mailBack" class="mail-img" />
					<img src="image/mail.png" id="mail" />
					<img src="image/mail_top.png" id="mailTop" class="mailTop" />
					<div class="mail-content">
						<p class="text1">Dear 耘瑄</p>
						<p class="text2">一直以來工作一定很忙吧，希望那些讓妳覺得辛苦的日子都能快快過去</p>
						<p class="text3">願接下來的每一天，好運小精靈都會一直圍繞在妳身邊 🧚，讓一切變得更順利</p>
						<p class="text5">如果有什麼需要幫忙的地方，我都很願意盡一份力，有困難儘管告訴我，只要我能幫上忙的話 ^^</p>
						<p class="text6">最後~ 祝妳生日快樂，願妳所有的願望都能實現，笑容永遠燦爛 🌈</p>
					</div>
				</div>
				
				<div style="z-index:0;" class="wall_paint"></div>
				<img src="image/room_floor2.png" style="z-index:0;" class="floor" />
				<div class="girl">
					<img src="image/girl.png" class="girl-img" />
					<div class="talk_prompt">
						<img src="image/room_prompt1.png" class="talking_prompt" />
						<img src="image/prompt_next_step.png" class="next_step" />
					</div>
				</div>
			</div>
	
			<div class="sky"></div>
			
			<img src="image/cloud2.png" class="cloud" id="cloud2" style="z-index: 0; left: 20%;" />

			<div class="hot_balloon">
				<img src="image/hot_balloon_line.png" />
				<img src="image/hot_balloon.png" class="hot-balloon-img" />
				<img src="image/hot_balloon_box.png" />
			</div>
			<img src="image/cloud1.png" class="cloud" id="cloud1" style="z-index: 0;" />
			
			<img src="image/birdFlyUp2.png" class="bird" />
			<img src="image/parachute_bear.png" class="parachuteBear" />
			<img src="image/UFO.png" class="UFO" />
			<img src="image/UFO_text0.png" style="display: none;" />
			<img src="image/UFO_text1.png" style="display: none;" />
			<img src="image/UFO_text2.png" style="display: none;" />
			<img src="image/UFO_text3.png" style="display: none;" />
			<img src="image/UFO_text4.png" style="display: none;" />
			<img src="image/UFO_text5.png" style="display: none;" />
			<img src="image/UFO_text6.png" style="display: none;" />
			<img src="image/UFO_text7.png" style="display: none;" />
			<img src="image/UFO_text8.png" style="display: none;" />
			<img src="image/UFO_text9.png" style="display: none;" />
			<img src="image/UFO_text10.png" style="display: none;" />
			<img src="image/UFO_text11.png" style="display: none;" />
			<img src="image/UFO_text12.png" style="display: none;" />
			<img src="image/UFO_text13.png" style="display: none;" />
		</div>
	</div>
	
	<div class="end" id="end">
		<h1 class="end-title">生日快樂</h1>
		<h2 class="end-whisper">
			<div class="start-btn whisper-btn">
				“我有悄悄話想對妳說”
			</div>
		</h2>
		<div class="confetti-container" id="confetti-container"></div>
	</div>

	<div class="whisper-content">
		<p class="whisper-text text1">耘瑄</p>
		<p class="whisper-text text2">雖然認識妳的時間不長</p>
		<p class="whisper-text text3">但妳認真工作的樣子、還有那份體貼溫柔，讓我很欣賞</p>
		<p class="whisper-text text5">當妳為工作煩惱或遇到不順心的事時，我也會不自覺替妳難過</p>
		<p class="whisper-text text6">直到那一刻我才明白，原來...</p>
		<p>
			<span class="whisper-lg-text text7">我</span>
			<span class="whisper-lg-text text8">喜</span>
			<span class="whisper-lg-text text9">歡</span>
			<span class="whisper-lg-text text10">妳</span>
		</p>
	</div>
	<audio id="audio" controls loop hidden src="audio/HappyBirthday.mp3" type="audio/mp3"></video>
</body>

<script type="text/javascript" src="JS/jquery.js"></script>
<script type="text/javascript" src="JS/jquery-ui-1.10.3.custom.js"></script>
<script type="text/javascript">
$(document).ready(function() {
	// 等待所有資源載入完成的函數
	function waitForAllResources() {
		return new Promise((resolve) => {
			let loadedCount = 0;
			let totalCount = 0;
			
			// 取得進度顯示元素
			const progressBar = document.getElementById('progress-bar');
			const loadingText = document.getElementById('loading-text');
			
			if (!progressBar || !loadingText) {
				console.error('無法找到進度顯示元素');
				resolve();
				return;
			}
			
			// 計算需要載入的圖片數量
			const images = document.querySelectorAll('img');
			
			// 計算需要載入的 CSS 文件數量  
			const cssLinks = document.querySelectorAll('link[rel="stylesheet"]');
			
			// 簡化字體計算，直接設為 2
			const fontCount = 2;
			
			totalCount = images.length + cssLinks.length + fontCount;
			
			// 如果沒有資源需要載入，直接完成
			if (totalCount === 0) {
				console.log('沒有資源需要載入，直接完成');
				resolve();
				return;
			}
			
			function updateProgress() {
				const percentage = Math.round((loadedCount / totalCount) * 100);
				progressBar.style.width = percentage + '%';
				loadingText.textContent = `載入進度 ${loadedCount}/${totalCount} (${percentage}%)`;
			}
			
			function checkComplete() {
				loadedCount++;
				updateProgress();
				
				if (loadedCount >= totalCount) {
					loadingText.textContent = '載入完成！';
					setTimeout(() => {
						resolve();
					}, 1000);
				}
			}
			
			// 檢查圖片載入
			images.forEach((img, index) => {
				if (img.complete && img.naturalHeight !== 0) {
					checkComplete();
				} else {
					img.onload = () => {
						checkComplete();
					};
					img.onerror = () => {
						checkComplete();
					};
				}
			});
			
			// 檢查 CSS 載入
			cssLinks.forEach((link, index) => {
				if (link.sheet) {
					checkComplete();
				} else {
					link.onload = () => {
						console.log(`CSS 載入完成: ${link.href}`);
						checkComplete();
					};
					link.onerror = () => {
						console.warn(`CSS 載入失敗: ${link.href}`);
						checkComplete();
					};
				}
			});
			
			// 檢查字體載入 - 簡化處理
			setTimeout(() => {
				for (let i = 0; i < fontCount; i++) {
					checkComplete();
				}
			}, 1000);
			
			// 設定最大等待時間（5秒）
			setTimeout(() => {
				console.log('載入超時，強制繼續');
				resolve();
			}, 5000);
		});
	}
	
	// 執行資源載入等待
	waitForAllResources().then(() => {
		// 隱藏載入畫面，顯示開始按鈕
		$("#loading-screen").fadeOut(800, function() {
			console.log('載入畫面已隱藏，顯示開始按鈕');
		});

		// 初始化房間物件位置
		initObjectSetting();
	}).catch((error) => {
		console.error('資源載入過程中發生錯誤:', error);
		// 即使發生錯誤也要顯示開始按鈕
		$("#loading-screen").fadeOut(800, function() {
			$("#start").fadeIn(500);
		});
	});
    
	// 背景音樂
	const audio = document.getElementById('audio');
	const play = document.getElementById("start");

	// 螢幕寬高
	let screenW = 0;
	let screenH = 0;

	// 房間物件高度
	let birthdayHeight = 0;
	let birthdayWidth = 0;
	let floorHeight = 0;
	let deskHeight = 0;
	let deskWidth = 0;
	let tvHeight = 0;
	let tvWidth = 0;
	let lightHeight = 0;
	let lightWidth = 0;
	let girlHeight = 0;
	let girlWidth = 0;
	let promptHeight 
	let promptWidth 
	let sofaHeight = 0;
	let sofaWidth = 0;
	let windowHeight = 0;
	let windowWidth = 0;
	let pictureHeight = 0;
	let pictureWidth = 0;
	let balloonHeight 
	let balloonWidth 
	let calenderHeight = 0;
	let calenderWidth = 0;
	let mailHeight = 0;
	let mailWidth = 0;
	let giftHeight = 0;
	let giftWidth = 0;
	let hotBalloonHeight = 0;
	let hotBalloonWidth = 0;
	let birdHeight = 0;
	let birdWidth = 0;

	// 取得實際可視區域的寬高（排除瀏覽器 UI）
	function getViewportSize() {
		// 使用 window.innerWidth/Height 獲取實際可視區域
		// 這會排除瀏覽器的導覽列、工具列等 UI 元素
		const screenW = window.innerWidth;
		const screenH = window.innerHeight;
		
		return { width: screenW, height: screenH };
	}
	
	// 開始畫面
	$(".start").click(function() {
		start();
	});

	function initObjectSetting() {
		// 獲取視窗尺寸
		const viewport = getViewportSize();
		screenW = viewport.width;
		screenH = viewport.height;

		// 取得房間物件高度並定位
		birthdayHeight = $(".birthday-img").height();
		birthdayWidth = $(".birthday-img").width();
		floorHeight = $(".floor").height();
		deskHeight = $(".desk-img").height();
		deskWidth = $(".desk-img").width();
		tvHeight = $(".tv-img").height();
		tvWidth = $(".tv-img").width();
		lightHeight = $(".light-img").height();
		lightWidth = $(".light-img").width();
		girlHeight = $(".girl-img").height();
		girlWidth = $(".girl-img").width();
		promptHeight = $(".talking_prompt").height();
		promptWidth = $(".talking_prompt").width();
		sofaHeight = $(".sofa-img").height();
		sofaWidth = $(".sofa-img").width();
		windowHeight = $(".window-img").height();
		windowWidth = $(".window-img").width();
		pictureHeight = $(".picture-img").height();
		pictureWidth = $(".picture-img").width();
		balloonHeight = $(".balloon").height();
		balloonWidth = $(".balloon").width();
		calenderHeight = $(".calender-img").height();
		calenderWidth = $(".calender-img").width();
		mailHeight = $(".mail-img").height();
		mailWidth = $(".mail-img").width();
		giftHeight = $(".gift-img").height();
		giftWidth = $(".gift-img").width();
		hotBalloonHeight = $(".hot-balloon-img").height();
		hotBalloonWidth = $(".hot-balloon-img").width();
		birdHeight = $(".bird").height();
		birdWidth = $(".bird").width();

		// 設定房間物件大小
		$(".talk_prompt").css("height", promptHeight + "px");
		$(".talk_prompt").css("width", promptWidth + "px");

		// 設定房間物件定位
		const lightBottomPosition = -25;
		const lightRightPosition = -45;
		$(".birthday").css("bottom", screenH + birthdayHeight + "px");
		$(".desk").css("bottom", (deskHeight + (floorHeight / 2)) + "px");
		$(".desk").css("left", deskWidth * 0.1 + "px");
		$(".TV").css("bottom", (tvHeight + deskHeight + (floorHeight / 2)) - 2 + "px");
		$(".TV").css("left", (deskWidth / 2) - (tvWidth / 2) + (deskWidth * 0.1) + "px");
		$(".light").css("bottom", (lightHeight + (floorHeight / 2)) + lightBottomPosition + "px");
		$(".light").css("right", lightWidth + lightRightPosition + "px");
		$(".girl").css("bottom", girlHeight + "px");
		$(".girl").css("left", (-1 * girlWidth) + "px");
		$(".talk_prompt").css("bottom", 0 + "px");
		$(".next_step").css("top", "270px");
		$(".next_step").css("right", "200px");
		$(".sofa").css("bottom", (sofaHeight + (floorHeight / 2)) + "px");
		$(".sofa").css("right", sofaWidth * 0.55 + "px");
		$(".window").css("bottom", floorHeight + deskHeight + tvHeight + windowHeight + "px");
		$(".window").css("left", windowWidth * 0.25 + "px");
		$(".picture").css("bottom", floorHeight + deskHeight + tvHeight + windowHeight + "px");
		$(".picture").css("left", screenW / 2 - pictureWidth / 2 + 30 + "px");
		$(".balloon").css("bottom", floorHeight + deskHeight + tvHeight + (balloonHeight / 2) + "px");
		$(".balloon").css("right", balloonWidth / 2 + "px");
		$(".calender").css("bottom", floorHeight + deskHeight + tvHeight + windowHeight - pictureHeight * 1.5 + "px");
		$(".calender").css("left", screenW / 2 - pictureWidth / 2 + 30 + "px");
		$(".mail").css("bottom", floorHeight + deskHeight + tvHeight + windowHeight - pictureHeight + "px");
		$(".mail").css("left", screenW / 2 - mailWidth / 2 + 30 + "px");
		$(".gift").css("bottom",  screenH / 2 + giftHeight * 2 + "px");
		$(".gift").css("left", screenW / 2 - giftWidth / 2 + 30 + "px");
		$(".hot_balloon").css("bottom", screenH + hotBalloonHeight + "px");
		$(".hot_balloon").css("left", screenW / 2 - hotBalloonWidth / 2 + "px");
		$(".bird").css("bottom", "0px");
		$(".bird").css("left", (-1 * birdWidth) + "px");

		// 開始畫面設定
		$(".start").css("line-height", $(".start").css("height"));
		$(".noise").css("width", screenW + "px");
	}
	
	function start() {
		// 音樂播放並顯示開始畫面
		audio.play();
		$(".start").fadeOut(1); 
		
		// 呈現初始的房間配置
		$(".floor").addClass("floorMove");
		$(".wall_paint").addClass("wall_paintMove");
		// $(".birthday").addClass("birthdayMove");
		$(".balloon").addClass("balloonMove");

		// 房間物件動畫
		$(".birthday").animate({ bottom: (floorHeight + deskHeight + tvHeight + windowHeight + (birthdayHeight / 2)) + "px" }, 1500);
		$(".window").delay(1500).animate({ opacity: 1 }, 600);
		$(".desk").delay(1800).animate({ opacity: 1 }, 600);
		$(".TV").delay(2000).animate({ opacity: 1 }, 600);
		$(".picture").delay(3500).animate({ opacity: 1 }, 600);
		$(".light").delay(2000).animate({ opacity: 1 }, 1000);
		$(".calender").delay(3000).animate({ opacity: 1 }, 500);
		$(".sofa").delay(2500).animate({ opacity: 1 }, 600);
		$(".girl").delay(3200).animate({ "left":"10%" }, 1000);
		$(".balloon").delay(4200).animate({ opacity: 1 }, 800);
		$(".talk_prompt").delay(4300).animate({ opacity: 1 }, 800);
		
		let step = 1;
		$(".next_step").click(function() {
			if(step == 1) {
				$(".talking_prompt").attr("src", "image/room_prompt2.png");
				$(this).attr("src", "image/prompt_finish_step.png");
				step++;
			} else {
				$(".talk_prompt").fadeOut(300);
				$(".girl").animate({ "left": (-1 * girlWidth) + "px" }, 800);
			}
		});
		
		let window = false;
		$(".window").click(function() {
			if(window) {
				$(".window > img").attr("src", "image/window_night.png");
				$(".sky").css("background", "url('image/sky_night.jpg')");
				window = false;
			} else {
				$(".window > img").attr("src", "image/window.png");
				$(".sky").css("background", "url('image/sky.jpg')");
				window = true;
			}
		});
		
		let tv = true;
		let wheelWater;
		$(".TV").click(function() {
			if(tv) {
				$(".TV > .object").fadeOut(100);
				$(".TV > .TV_wheel").fadeIn(300);
				wheelWater = setInterval(function() {
					$(".TV > .TV_wheel_water").fadeIn(400);
					$(".TV > .TV_wheel_water").delay(400).fadeOut(100);
				}, 500);
				tv = false;
			}
			else {
				$(".TV > .object").fadeIn(100);
				clearInterval(wheelWater);
				$(".TV > .TV_wheel").fadeOut(300);
				$(".TV > .TV_wheel_water").fadeOut(100);
				tv = true;
			}
		});
		
		$(".sofa").click(function() {
			$(this).find(".bear").animate({
				"top": (3 * screenH / 100) + "px"
			}, 1200);
		});
		
		let gift = false;
		$(".calender").click(function() {
			if(!gift) {
				$(this).find(".object").attr("src", "image/calender2_click.png");
				$(".gift").animate({ opacity: 1 }, 800);
				$(".gift").delay(200).animate({ bottom: floorHeight / 2 + giftHeight + "px" }, 2500);
				gift = true;
			}
		});
		
		let mail= false;
		$(".picture").click(function() {
			if(!mail) {
				$(".mail").animate({ opacity: 1 }, 800)
				$(".mail").animate({
					"bottom": floorHeight + deskHeight + tvHeight + windowHeight / 2 + "px",
					"left": screenW / 2 - pictureWidth / 2 + 30 - 120 + "px",
					"deg": 45
				}, {
					duration: 800,
					step: function (now) {
						$(this).css({ transform: 'rotate(' + now + 'deg)' });
					}
				}, "quadEaseOut");
				$(".mail").delay(100).animate({
					"bottom": floorHeight + deskHeight + tvHeight + "px",
					"left": screenW / 2 - pictureWidth / 2 + 30 + 180 + "px",
					"deg": -30
				}, {
					duration: 800,
					step: function (now) {
						$(this).css({ transform: 'rotate(' + now + 'deg)' });
					}
				}, "quadEaseOut");
				$(".mail").delay(100).animate({
					"bottom": floorHeight + deskHeight + "px",
					"left": screenW / 2 - pictureWidth / 2 + 30 - 140 + "px",
					"deg": 30
				}, {
					duration: 800,
					step: function (now) {
						$(this).css({ transform: 'rotate(' + now + 'deg)' });
					}
				}, "quadEaseOut");
				$(".mail").delay(100).animate({
					"bottom": floorHeight + "px",
					"left": screenW / 2 - pictureWidth / 2 + "px",
					"deg": 0
				}, {
					duration: 800,
					step: function (now) {
						$(this).css({ transform: 'rotate(' + now + 'deg)' });
					}
				}, "quadEaseOut");
				mail = true;
			}
		});
		
		$(".balloon").click(function() {
			if($(this).attr("name") !== "flying") {
				$(this).fadeOut(200);
			} else if($(this).attr("name") === "flying") {
				if(gift && mail) {
					$(this).css("z-index", "1");
					$(this).removeClass("balloon3");
					$(this).animate({
						"bottom": floorHeight + "px",
						"left": screenW / 2 - balloonWidth / 2 + "px"
					}, 1800);
					
					let counter = 0;
					const balloonDown = setInterval(function() {
						counter += 100;
						if(counter === 1800) {
							$(".boxlight").fadeIn(500);
							$(".boxlight").css("display", "flex");
							$(".boxlight > p").text("Are you ready?");
							clearInterval(balloonDown);
						}
					}, 100);
				}
			}
		});
		
		$(".GoButton").click(function() {
			$(this).fadeOut(600);
			let time = 3;
			const decounterTimer = setInterval(function() {
				$(".boxlight > p").text(time);
				if(time === 0) {
					$(".boxlight > p").text("GO!!");
					$(".boxlight").delay(150).fadeOut(300);
					$(".mail").css("position","fixed");
					$(".gift").css("position","fixed");
					$(".balloon").removeClass("balloon3Fly");
					$(".balloon").css("position","fixed");
					
					$(".room").delay(600).animate({ "top": "100%" }, 4000);
					$(".room img").not(".mail > img, .gift > img, .balloon").delay(600).fadeOut(3400);

					$(".balloon").delay(3500).animate({ "bottom": floorHeight + 200 + "px" }, 1000);
					$(".mail").delay(3500).animate({ "bottom": floorHeight + 200 + "px" }, 1000);
					$(".gift").delay(3500).animate({ "bottom": floorHeight / 2 + giftHeight + 200 + "px" }, 1000);

					$(".hot_balloon").delay(700).animate({ "bottom": floorHeight + hotBalloonHeight + 120 + "px" }, 4500);
					$(".balloon").fadeOut(600);
					
					$(".cloud").delay(2000).fadeIn(1000);
					$("#cloud1").css("z-index", "4");
					$("#cloud1").addClass("cloudDown1");
					$("#cloud2").addClass("cloudDown2");
				} else if(time === -5) {
					clearInterval(decounterTimer);
					skyRun();
				}
				time--;
			}, 1000);
		});
		
		function skyRun() {
			let bird = true;
			let timer = 0;
			const skyFly = setInterval(function() {
				if(bird) {
					$(".bird").attr("src", "image/birdFlyDown2.png");
					bird = false;
				} else {
					$(".bird").attr("src", "image/birdFlyUp2.png");
					bird = true;
				}
				
				if(timer === 6) {
					birdAnimation();
				} else if(timer === 24) {
					$(".bird").css("display","none");
				}
				
				if(timer === 26) {
					$(".parachuteBear").animate({ "top":"105%" }, 10000);
				} else if(timer === 34) {
					$(".parachuteBear").attr("src", "image/parachute_bear_talk2.png");
				} else if(timer === 46) {
					$(".parachuteBear").css("display", "none");
				}
				
				if(timer === 48) {
					$(".UFO").addClass("UFOFLY");
				} else if(timer === 54) {
					UFO();
					clearInterval(skyFly);
				}
				
				timer++;
			}, 500);
		}

		function birdAnimation() {
			$(".bird").animate({
				"bottom": screenH + birdHeight + "px",
				"left": screenW + birdWidth + "px"
			}, 7500, "linear");
		}

		function UFO() {
			let ufoIndex = 0;
			const ufoTimer = setInterval(function() {
				if(ufoIndex >= 0 && ufoIndex <= 13) {
					$(".UFO").attr("src", "image/UFO_text"+ufoIndex+".png");
				} else if(ufoIndex === 22) {
					clearInterval(ufoTimer);
					$(".UFO").attr("src", "image/UFO.png");
					$(".UFO").delay(500).animate({ "top":"110%", "left":"60%" }, 500);
					skyEnd();
				}
				ufoIndex++;
			}, 100);
		}

		let giftOpen = false;
		function skyEnd() {
			$(".cloud").fadeOut(1200);
			$(".hot_balloon").removeClass("hotBalloonFly");
			$(".hot_balloon").animate({ "top": -1 * hotBalloonHeight + "px" }, 3200);
			
			$(".mail").delay(1500).animate({
				"top": screenH / 2 - mailHeight + "px",
				"left": screenW / 2 - mailWidth / 2 + "px"
			}, 2000);
			$(".mail > img").delay(1500).animate({ "width": (screenW / 10) + "px" }, 2000);
			
			$(".gift").delay(1500).animate({
				"top": screenH / 2 - giftHeight + "px",
				"left": screenW / 2 - giftWidth + "px"
			}, 2000);
			$(".gift > img").delay(1500).animate({ "width": (screenW / 3) + "px" }, 2000);
			
			let end = 0;
			const endTimer = setInterval(function() {
				if (end === 40) {
					$(".mailTop").addClass("mailOpen");
				} else if (end === 65) {
					$("#mail").fadeOut(800);
					$("#mailTop").fadeOut(800);
					$("#mailBack").fadeOut(800);
					$(".mail").animate({
						"top": screenH * 0.2 + "px",
						"left": screenW * 0.1 + "px"
					}, 800);
					$(".mail-content").delay(500).animate({
						"opacity": 1,
						"height": (screenH * 0.6) + "px",
						"width": (screenW * 0.8) + "px"
					}, 800);
				} else if (end === 75) {
					$(".text1").fadeIn(600);
				} else if (end === 95) {
					$(".text2").fadeIn(600);
				} else if (end === 110) {
					$(".text3").fadeIn(600);
				} else if (end === 125) {
					$(".text4").fadeIn(600);
				} else if (end === 140) {
					$(".text5").fadeIn(600);
				} else if (end === 155) {
					$(".text6").fadeIn(600);
				} else if (end === 200) {
					$(".mail > div").fadeOut(600);
					$(".mail p").fadeOut(600);
					$(".mail-content").fadeOut(600);
					giftOpen = true;
					clearInterval(endTimer);

					if (giftOpen) {
						$(".giftTop").addClass("giftOpen");
						$("#gift").delay(1500).fadeOut(600);
						$(".giftTop").delay(1500).fadeOut(600);
						$(".end-title").css("margin-top", screenH * 0.5 + 50 + "px");
						$(".cake").delay(1500).animate({
							"top": "-200px",
							"width": screenW * 0.5 + "px",
						}, 1200);
						$(".gift").delay(1500).animate({ "left": screenW * 0.25 + "px" }, 1200);
						$(".end").css("display", "flex");
						$(".end").delay(2000).animate({ "opacity": 1 }, 800);

						let confettiTimes = 0
						const confettiInterval = setInterval(() => {
							generateConfetti();
							confettiTimes++;

							if (confettiTimes === 3) {
								$(".end-whisper").animate({ "opacity": 1 }, 800);
							}

							if (confettiTimes === 8) {
								clearInterval(confettiInterval);
							}
						}, 1000);
					}
				}
				end++;
			}, 100);
		}

		$(".whisper-btn").click(function() {
			$(".whisper-content").css("display", "flex");
			$(".whisper-content").animate({ "opacity": 1 }, 1500);

			$(".whisper-content .text1").delay(2000).animate({ opacity: 1 }, 600);
			$(".whisper-content .text2").delay(3000).animate({ opacity: 1 }, 600);
			$(".whisper-content .text3").delay(4000).animate({ opacity: 1 }, 600);
			$(".whisper-content .text4").delay(5000).animate({ opacity: 1 }, 600);
			$(".whisper-content .text5").delay(6000).animate({ opacity: 1 }, 600);
			$(".whisper-content .text6").delay(7000).animate({ opacity: 1 }, 600);
			$(".whisper-content .text7").delay(8500).animate({ opacity: 1, top: '0px' }, 600);
			$(".whisper-content .text8").delay(9500).animate({ opacity: 1, top: '0px' }, 600);
			$(".whisper-content .text9").delay(10500).animate({ opacity: 1, top: '0px' }, 600);
			$(".whisper-content .text10").delay(11500).animate({ opacity: 1, top: '0px' }, 600);
		});
	}

	function generateConfetti () {
		const confettiContainer = document.getElementById('confetti-container');
		for (let i = 0; i < 40; i++) {
			confettiContainer.style.left = 25 + Math.floor(Math.random() * 50) + "%";
			confettiContainer.style.top = 5 + Math.floor(Math.random() * 50) + "%";

			const confetti = document.createElement('div');
			confetti.classList.add('confetti');
			confetti.style.background = `hsl(${Math.random() * 360}, 100%, 60%)`;
			
			const angle = Math.random() * 2 * Math.PI;
			const distance = Math.random() * 300 + 100;
			confetti.style.setProperty('--x', `${Math.cos(angle) * distance}px`);
			confetti.style.setProperty('--y', `${Math.sin(angle) * distance}px`);
			
			confetti.style.left = '50%';
			confetti.style.top = '50%';
			confettiContainer.appendChild(confetti);

			setTimeout(() => confetti.remove(), 1000);
		}
	}
});
</script>